<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Deployment on OpenStack &mdash; OSE3 Advanced Enablement Homework 1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="OSE3 Advanced Enablement Homework 1.0 documentation" href="index.html" />
    <link rel="next" title="Security Groups" href="security-groups.html" />
    <link rel="prev" title="README" href="README.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="deployment-on-openstack">
<h1>Deployment on OpenStack<a class="headerlink" href="#deployment-on-openstack" title="Permalink to this headline">¶</a></h1>
<p>Here, we will provision the servers and other resources needed for the OSE3
installation. This deployment is targeted for use with the OS1 Public
cloud. Other OpenStack clouds may be used but are untested. Modifications may
be needed for these examples to work in other OpenStack environments.</p>
<p>These examples assume you&#8217;re starting from scratch and have no existing
instances. If you have existing instances, you&#8217;ll have to adjust these examples
for your specific environment.</p>
<div class="section" id="architecture">
<h2>Architecture<a class="headerlink" href="#architecture" title="Permalink to this headline">¶</a></h2>
<p>The HA deployment of OSE 3.2 will consist of the following hosts:</p>
<ul class="simple">
<li>1 x Installer</li>
<li>3 x Masters</li>
<li>4 x Nodes (2 Infra, 2 App)</li>
<li>2 x Load Balancers</li>
<li>1 x DNS</li>
</ul>
<p>Below are the hardware specs for each host type:</p>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="11%" />
<col width="19%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Node Type</th>
<th class="head">CPUs</th>
<th class="head">RAM (GB)</th>
<th class="head">Disk 1 (GB)</th>
<th class="head">Disk 2 (GB)</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Installer</td>
<td>2</td>
<td>4</td>
<td>20</td>
<td>None</td>
</tr>
<tr class="row-odd"><td>Master</td>
<td>2</td>
<td>4</td>
<td>40</td>
<td>15</td>
</tr>
<tr class="row-even"><td>Compute</td>
<td>2</td>
<td>4</td>
<td>25</td>
<td>15</td>
</tr>
<tr class="row-odd"><td>LB</td>
<td>2</td>
<td>4</td>
<td>20</td>
<td>None</td>
</tr>
<tr class="row-even"><td>DNS</td>
<td>2</td>
<td>4</td>
<td>20</td>
<td>None</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="openstack-environment">
<h2>OpenStack Environment<a class="headerlink" href="#openstack-environment" title="Permalink to this headline">¶</a></h2>
<p>The following examples require that your environment be configured with your
OpenStack login credentials. This is typically accomplished by running:</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>$ <span class="nb">source</span> openrc.sh
</pre></div>
</div>
<p>You can download the above file from the &#8220;Access &amp; Security&#8221; page in the
OpenStack dashboard.</p>
</div>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<div class="section" id="images">
<h3>Images<a class="headerlink" href="#images" title="Permalink to this headline">¶</a></h3>
<p>A valid RHEL 7 base image must be available prior to running these examples,
and it must be named &#8216;RHEL7&#8217;. This image will be used to provision the servers
in these examples.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">openstackclient.shell</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">shlex</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">openstackclient</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">shlex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;image show RHEL7&#39;</span><span class="p">))</span>
<span class="go">+------------------+------------------------------------------------------+</span>
<span class="go">| Field            | Value                                                |</span>
<span class="go">+------------------+------------------------------------------------------+</span>
<span class="gp">...</span>
<span class="go">| name             | RHEL7                                                |</span>
<span class="gp">...</span>
<span class="go">+------------------+------------------------------------------------------+</span>
<span class="go">0</span>
</pre></div>
</div>
</div>
<div class="section" id="flavors">
<h3>Flavors<a class="headerlink" href="#flavors" title="Permalink to this headline">¶</a></h3>
<p>All instances use the &#8220;m1.medium&#8221; flavor, which has 2 CPUs and 4GB RAM.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">openstackclient</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">shlex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;flavor show m1.medium&#39;</span><span class="p">))</span>
<span class="go">+----------------------------+--------------------------------------+</span>
<span class="go">| Field                      | Value                                |</span>
<span class="go">+----------------------------+--------------------------------------+</span>
<span class="gp">...</span>
<span class="go">| name                       | m1.medium                            |</span>
<span class="gp">...</span>
<span class="go">| ram                        | 4096                                 |</span>
<span class="gp">...</span>
<span class="go">| vcpus                      | 2                                    |</span>
<span class="go">+----------------------------+--------------------------------------+</span>
<span class="go">0</span>
</pre></div>
</div>
</div>
<div class="section" id="security-groups">
<h3>Security Groups<a class="headerlink" href="#security-groups" title="Permalink to this headline">¶</a></h3>
<p>The &#8220;default&#8221; security group allows SSH and ICMP (ping).</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">openstackclient</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">shlex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;security group show default&#39;</span><span class="p">))</span>
<span class="go">+-------------+--------------------------------------------------------------------------+</span>
<span class="go">| Field       | Value                                                                    |</span>
<span class="go">+-------------+--------------------------------------------------------------------------+</span>
<span class="gp">...</span>
<span class="go">| name        | default                                                                  |</span>
<span class="gp">...</span>
<span class="go">+-------------+--------------------------------------------------------------------------+</span>
<span class="go">0</span>
</pre></div>
</div>
<p>The &#8220;dns&#8221; security group allows DNS server traffic.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">openstackclient</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">shlex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;security group show dns&#39;</span><span class="p">))</span>
<span class="go">+-------------+-------------------------------------------------------------------------+</span>
<span class="go">| Field       | Value                                                                   |</span>
<span class="go">+-------------+-------------------------------------------------------------------------+</span>
<span class="gp">...</span>
<span class="go">| name        | dns                                                                     |</span>
<span class="gp">...</span>
<span class="go">+-------------+-------------------------------------------------------------------------+</span>
<span class="go">0</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="provisioning">
<h2>Provisioning<a class="headerlink" href="#provisioning" title="Permalink to this headline">¶</a></h2>
<p>At this point, we can begin provisioning. We&#8217;ll use the Ansible OpenStack
modules. Here&#8217;s our playbook:</p>
<div class="literal-block-wrapper container" id="ansible-provision-openstack-yaml">
<div class="code-block-caption"><span class="caption-text">ansible/provision-openstack.yaml</span><a class="headerlink" href="#ansible-provision-openstack-yaml" title="Permalink to this code">¶</a></div>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">provision server resources in OpenStack</span>
  <span class="l l-Scalar l-Scalar-Plain">hosts</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">localhost</span>
  <span class="l l-Scalar l-Scalar-Plain">vars</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">master_count</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
    <span class="l l-Scalar l-Scalar-Plain">node_count</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">4</span>
    <span class="l l-Scalar l-Scalar-Plain">lb_count</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
    <span class="l l-Scalar l-Scalar-Plain">namespace</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">demo</span>
    <span class="l l-Scalar l-Scalar-Plain">installer_security_groups</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
    <span class="l l-Scalar l-Scalar-Plain">master_security_groups</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
    <span class="l l-Scalar l-Scalar-Plain">node_security_groups</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
    <span class="l l-Scalar l-Scalar-Plain">lb_security_groups</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
    <span class="l l-Scalar l-Scalar-Plain">dns_security_groups</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
  <span class="l l-Scalar l-Scalar-Plain">vars_files</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">vars/openstack.yaml</span>
  <span class="l l-Scalar l-Scalar-Plain">tasks</span><span class="p p-Indicator">:</span>

    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">create OSE installer root volume</span>
      <span class="l l-Scalar l-Scalar-Plain">os_volume</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">state</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">present</span>
        <span class="l l-Scalar l-Scalar-Plain">size</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">20</span>
        <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">RHEL7</span>
        <span class="l l-Scalar l-Scalar-Plain">display_name</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">namespace</span><span class="nv"> </span><span class="s">}}-ose-installer-root-vol&quot;</span>

    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">create OSE master root volumes</span>
      <span class="l l-Scalar l-Scalar-Plain">os_volume</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">state</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">present</span>
        <span class="l l-Scalar l-Scalar-Plain">size</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">40</span>
        <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">RHEL7</span>
        <span class="l l-Scalar l-Scalar-Plain">display_name</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">namespace</span><span class="nv"> </span><span class="s">}}-{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}&quot;</span>
      <span class="l l-Scalar l-Scalar-Plain">with_sequence</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">start=1 end={{ master_count }} format=ose-master-%d-root-vol</span>

    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">create OSE node root volumes</span>
      <span class="l l-Scalar l-Scalar-Plain">os_volume</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">state</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">present</span>
        <span class="l l-Scalar l-Scalar-Plain">size</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">25</span>
        <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">RHEL7</span>
        <span class="l l-Scalar l-Scalar-Plain">display_name</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">namespace</span><span class="nv"> </span><span class="s">}}-{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}&quot;</span>
      <span class="l l-Scalar l-Scalar-Plain">with_sequence</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">start=1 end={{ node_count }} format=ose-node-%d-root-vol</span>

    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">create LB root volumes</span>
      <span class="l l-Scalar l-Scalar-Plain">os_volume</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">state</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">present</span>
        <span class="l l-Scalar l-Scalar-Plain">size</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">20</span>
        <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">RHEL7</span>
        <span class="l l-Scalar l-Scalar-Plain">display_name</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">namespace</span><span class="nv"> </span><span class="s">}}-{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}&quot;</span>
      <span class="l l-Scalar l-Scalar-Plain">with_sequence</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">start=1 end={{ lb_count }} format=ose-lb-%d-root-vol</span>

    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">create DNS root volume</span>
      <span class="l l-Scalar l-Scalar-Plain">os_volume</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">state</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">present</span>
        <span class="l l-Scalar l-Scalar-Plain">size</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">20</span>
        <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">RHEL7</span>
        <span class="l l-Scalar l-Scalar-Plain">display_name</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">namespace</span><span class="nv"> </span><span class="s">}}-ose-dns-root-vol&quot;</span>

    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">create Docker storage volumes for OSE masters</span>
      <span class="l l-Scalar l-Scalar-Plain">os_volume</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">state</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">present</span>
        <span class="l l-Scalar l-Scalar-Plain">size</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">15</span>
        <span class="l l-Scalar l-Scalar-Plain">display_name</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">namespace</span><span class="nv"> </span><span class="s">}}-{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}&quot;</span>
      <span class="l l-Scalar l-Scalar-Plain">with_sequence</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">start=1 end={{ master_count }} format=master-%d-docker-vol</span>

    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">create Docker storage volumes for OSE nodes</span>
      <span class="l l-Scalar l-Scalar-Plain">os_volume</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">state</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">present</span>
        <span class="l l-Scalar l-Scalar-Plain">size</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">15</span>
        <span class="l l-Scalar l-Scalar-Plain">display_name</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">namespace</span><span class="nv"> </span><span class="s">}}-{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}&quot;</span>
      <span class="l l-Scalar l-Scalar-Plain">with_sequence</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">start=1 end={{ node_count }} format=ose-node-%d-docker-vol</span>

    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">create OSE installer instance</span>
      <span class="l l-Scalar l-Scalar-Plain">os_server</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">namespace</span><span class="nv"> </span><span class="s">}}-ose-installer&quot;</span>
        <span class="l l-Scalar l-Scalar-Plain">state</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">present</span>
        <span class="l l-Scalar l-Scalar-Plain">flavor</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">m1.medium</span>
        <span class="l l-Scalar l-Scalar-Plain">boot_volume</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">namespace</span><span class="nv"> </span><span class="s">}}-ose-installer-root-vol&quot;</span>
        <span class="l l-Scalar l-Scalar-Plain">key_name</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">openstack_key_name</span><span class="nv"> </span><span class="s">}}&quot;</span>
        <span class="l l-Scalar l-Scalar-Plain">security_groups</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">installer_security_groups</span><span class="nv"> </span><span class="s">}}&quot;</span>

    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">create OSE master instances</span>
      <span class="l l-Scalar l-Scalar-Plain">os_server</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">namespace</span><span class="nv"> </span><span class="s">}}-{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}&quot;</span>
        <span class="l l-Scalar l-Scalar-Plain">state</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">present</span>
        <span class="l l-Scalar l-Scalar-Plain">flavor</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">m1.medium</span>
        <span class="l l-Scalar l-Scalar-Plain">boot_volume</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">namespace</span><span class="nv"> </span><span class="s">}}-{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}-root-vol&quot;</span>
        <span class="l l-Scalar l-Scalar-Plain">key_name</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">openstack_key_name</span><span class="nv"> </span><span class="s">}}&quot;</span>
        <span class="l l-Scalar l-Scalar-Plain">security_groups</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">master_security_groups</span><span class="nv"> </span><span class="s">}}&quot;</span>
        <span class="l l-Scalar l-Scalar-Plain">volumes</span><span class="p p-Indicator">:</span>
          <span class="p p-Indicator">-</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">namespace</span><span class="nv"> </span><span class="s">}}-{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}-docker-vol&quot;</span>
      <span class="l l-Scalar l-Scalar-Plain">with_sequence</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">start=1 end={{ master_count }} format=ose-master-%d</span>

    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">create OSE node instances</span>
      <span class="l l-Scalar l-Scalar-Plain">os_server</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">namespace</span><span class="nv"> </span><span class="s">}}-{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}&quot;</span>
        <span class="l l-Scalar l-Scalar-Plain">state</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">present</span>
        <span class="l l-Scalar l-Scalar-Plain">flavor</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">m1.medium</span>
        <span class="l l-Scalar l-Scalar-Plain">boot_volume</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">namespace</span><span class="nv"> </span><span class="s">}}-{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}-root-vol&quot;</span>
        <span class="l l-Scalar l-Scalar-Plain">key_name</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">openstack_key_name</span><span class="nv"> </span><span class="s">}}&quot;</span>
        <span class="l l-Scalar l-Scalar-Plain">security_groups</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">node_security_groups</span><span class="nv"> </span><span class="s">}}&quot;</span>
        <span class="l l-Scalar l-Scalar-Plain">volumes</span><span class="p p-Indicator">:</span>
          <span class="p p-Indicator">-</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">namespace</span><span class="nv"> </span><span class="s">}}-{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}-docker-vol&quot;</span>
      <span class="l l-Scalar l-Scalar-Plain">with_sequence</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">start=1 end={{ node_count }} format=ose-node-%d</span>

    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">create LB instances</span>
      <span class="l l-Scalar l-Scalar-Plain">os_server</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">namespace</span><span class="nv"> </span><span class="s">}}-{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}&quot;</span>
        <span class="l l-Scalar l-Scalar-Plain">state</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">present</span>
        <span class="l l-Scalar l-Scalar-Plain">flavor</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">m1.medium</span>
        <span class="l l-Scalar l-Scalar-Plain">boot_volume</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">namespace</span><span class="nv"> </span><span class="s">}}-{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}-root-vol&quot;</span>
        <span class="l l-Scalar l-Scalar-Plain">key_name</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">openstack_key_name</span><span class="nv"> </span><span class="s">}}&quot;</span>
        <span class="l l-Scalar l-Scalar-Plain">security_groups</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lb_security_groups</span><span class="nv"> </span><span class="s">}}&quot;</span>
      <span class="l l-Scalar l-Scalar-Plain">with_sequence</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">start=1 end={{ lb_count }} format=ose-lb-%d</span>

    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">create DNS instance</span>
      <span class="l l-Scalar l-Scalar-Plain">os_server</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">namespace</span><span class="nv"> </span><span class="s">}}-ose-dns&quot;</span>
        <span class="l l-Scalar l-Scalar-Plain">state</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">present</span>
        <span class="l l-Scalar l-Scalar-Plain">flavor</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">m1.medium</span>
        <span class="l l-Scalar l-Scalar-Plain">boot_volume</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">namespace</span><span class="nv"> </span><span class="s">}}-ose-dns-root-vol&quot;</span>
        <span class="l l-Scalar l-Scalar-Plain">key_name</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">openstack_key_name</span><span class="nv"> </span><span class="s">}}&quot;</span>
        <span class="l l-Scalar l-Scalar-Plain">security_groups</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">dns_security_groups</span><span class="nv"> </span><span class="s">}}&quot;</span>
</pre></div>
</div>
</div>
<p>Now let&#8217;s run it.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span> <span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">ansible.cli.playbook</span>
 <span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">run_playbook</span><span class="p">(</span><span class="n">cmd</span><span class="p">):</span>
 <span class="o">...</span>     <span class="s2">&quot;&quot;&quot;Helper function to run playbooks using the Playbook CLI.&quot;&quot;&quot;</span>
 <span class="o">...</span>     <span class="n">argv</span> <span class="o">=</span> <span class="n">shlex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
 <span class="o">...</span>     <span class="n">cli</span> <span class="o">=</span> <span class="n">ansible</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">playbook</span><span class="o">.</span><span class="n">PlaybookCLI</span><span class="p">([</span><span class="s1">&#39;ansible-playbook&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">argv</span><span class="p">)</span>
 <span class="o">...</span>     <span class="n">cli</span><span class="o">.</span><span class="n">parse</span><span class="p">()</span>
 <span class="o">...</span>     <span class="k">return</span> <span class="n">cli</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
 <span class="o">&gt;&gt;&gt;</span> <span class="n">run_playbook</span><span class="p">(</span><span class="s1">&#39;ansible/provision-openstack.yaml&#39;</span><span class="p">)</span>

 <span class="n">PLAY</span> <span class="p">[</span><span class="n">provision</span> <span class="n">server</span> <span class="n">resources</span> <span class="ow">in</span> <span class="n">OpenStack</span><span class="p">]</span> <span class="o">*********************************</span>

 <span class="n">TASK</span> <span class="p">[</span><span class="n">setup</span><span class="p">]</span> <span class="o">*******************************************************************</span>
 <span class="o">...</span><span class="p">:</span> <span class="p">[</span><span class="n">localhost</span><span class="p">]</span>

 <span class="n">TASK</span> <span class="p">[</span><span class="n">create</span> <span class="n">OSE</span> <span class="n">installer</span> <span class="n">root</span> <span class="n">volume</span><span class="p">]</span> <span class="o">****************************************</span>
 <span class="o">...</span><span class="p">:</span> <span class="p">[</span><span class="n">localhost</span><span class="p">]</span>

 <span class="n">TASK</span> <span class="p">[</span><span class="n">create</span> <span class="n">OSE</span> <span class="n">master</span> <span class="n">root</span> <span class="n">volumes</span><span class="p">]</span> <span class="o">******************************************</span>
 <span class="o">...</span><span class="p">:</span> <span class="p">[</span><span class="n">localhost</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">ose</span><span class="o">-</span><span class="n">master</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">root</span><span class="o">-</span><span class="n">vol</span><span class="p">)</span>
 <span class="o">...</span><span class="p">:</span> <span class="p">[</span><span class="n">localhost</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">ose</span><span class="o">-</span><span class="n">master</span><span class="o">-</span><span class="mi">2</span><span class="o">-</span><span class="n">root</span><span class="o">-</span><span class="n">vol</span><span class="p">)</span>
 <span class="o">...</span><span class="p">:</span> <span class="p">[</span><span class="n">localhost</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">ose</span><span class="o">-</span><span class="n">master</span><span class="o">-</span><span class="mi">3</span><span class="o">-</span><span class="n">root</span><span class="o">-</span><span class="n">vol</span><span class="p">)</span>

 <span class="n">TASK</span> <span class="p">[</span><span class="n">create</span> <span class="n">OSE</span> <span class="n">node</span> <span class="n">root</span> <span class="n">volumes</span><span class="p">]</span> <span class="o">********************************************</span>
 <span class="o">...</span><span class="p">:</span> <span class="p">[</span><span class="n">localhost</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">ose</span><span class="o">-</span><span class="n">node</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">root</span><span class="o">-</span><span class="n">vol</span><span class="p">)</span>
 <span class="o">...</span><span class="p">:</span> <span class="p">[</span><span class="n">localhost</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">ose</span><span class="o">-</span><span class="n">node</span><span class="o">-</span><span class="mi">2</span><span class="o">-</span><span class="n">root</span><span class="o">-</span><span class="n">vol</span><span class="p">)</span>
 <span class="o">...</span><span class="p">:</span> <span class="p">[</span><span class="n">localhost</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">ose</span><span class="o">-</span><span class="n">node</span><span class="o">-</span><span class="mi">3</span><span class="o">-</span><span class="n">root</span><span class="o">-</span><span class="n">vol</span><span class="p">)</span>
 <span class="o">...</span><span class="p">:</span> <span class="p">[</span><span class="n">localhost</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">ose</span><span class="o">-</span><span class="n">node</span><span class="o">-</span><span class="mi">4</span><span class="o">-</span><span class="n">root</span><span class="o">-</span><span class="n">vol</span><span class="p">)</span>

 <span class="n">TASK</span> <span class="p">[</span><span class="n">create</span> <span class="n">LB</span> <span class="n">root</span> <span class="n">volumes</span><span class="p">]</span> <span class="o">**************************************************</span>
 <span class="o">...</span><span class="p">:</span> <span class="p">[</span><span class="n">localhost</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">ose</span><span class="o">-</span><span class="n">lb</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">root</span><span class="o">-</span><span class="n">vol</span><span class="p">)</span>
 <span class="o">...</span><span class="p">:</span> <span class="p">[</span><span class="n">localhost</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">ose</span><span class="o">-</span><span class="n">lb</span><span class="o">-</span><span class="mi">2</span><span class="o">-</span><span class="n">root</span><span class="o">-</span><span class="n">vol</span><span class="p">)</span>

 <span class="n">TASK</span> <span class="p">[</span><span class="n">create</span> <span class="n">DNS</span> <span class="n">root</span> <span class="n">volume</span><span class="p">]</span> <span class="o">**************************************************</span>
 <span class="o">...</span><span class="p">:</span> <span class="p">[</span><span class="n">localhost</span><span class="p">]</span>

 <span class="n">TASK</span> <span class="p">[</span><span class="n">create</span> <span class="n">Docker</span> <span class="n">storage</span> <span class="n">volumes</span> <span class="k">for</span> <span class="n">OSE</span> <span class="n">masters</span><span class="p">]</span> <span class="o">***************************</span>
 <span class="o">...</span><span class="p">:</span> <span class="p">[</span><span class="n">localhost</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">master</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">docker</span><span class="o">-</span><span class="n">vol</span><span class="p">)</span>
 <span class="o">...</span><span class="p">:</span> <span class="p">[</span><span class="n">localhost</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">master</span><span class="o">-</span><span class="mi">2</span><span class="o">-</span><span class="n">docker</span><span class="o">-</span><span class="n">vol</span><span class="p">)</span>
 <span class="o">...</span><span class="p">:</span> <span class="p">[</span><span class="n">localhost</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">master</span><span class="o">-</span><span class="mi">3</span><span class="o">-</span><span class="n">docker</span><span class="o">-</span><span class="n">vol</span><span class="p">)</span>

 <span class="n">TASK</span> <span class="p">[</span><span class="n">create</span> <span class="n">Docker</span> <span class="n">storage</span> <span class="n">volumes</span> <span class="k">for</span> <span class="n">OSE</span> <span class="n">nodes</span><span class="p">]</span> <span class="o">*****************************</span>
 <span class="o">...</span><span class="p">:</span> <span class="p">[</span><span class="n">localhost</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">ose</span><span class="o">-</span><span class="n">node</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">docker</span><span class="o">-</span><span class="n">vol</span><span class="p">)</span>
 <span class="o">...</span><span class="p">:</span> <span class="p">[</span><span class="n">localhost</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">ose</span><span class="o">-</span><span class="n">node</span><span class="o">-</span><span class="mi">2</span><span class="o">-</span><span class="n">docker</span><span class="o">-</span><span class="n">vol</span><span class="p">)</span>
 <span class="o">...</span><span class="p">:</span> <span class="p">[</span><span class="n">localhost</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">ose</span><span class="o">-</span><span class="n">node</span><span class="o">-</span><span class="mi">3</span><span class="o">-</span><span class="n">docker</span><span class="o">-</span><span class="n">vol</span><span class="p">)</span>
 <span class="o">...</span><span class="p">:</span> <span class="p">[</span><span class="n">localhost</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">ose</span><span class="o">-</span><span class="n">node</span><span class="o">-</span><span class="mi">4</span><span class="o">-</span><span class="n">docker</span><span class="o">-</span><span class="n">vol</span><span class="p">)</span>

 <span class="n">TASK</span> <span class="p">[</span><span class="n">create</span> <span class="n">OSE</span> <span class="n">installer</span> <span class="n">instance</span><span class="p">]</span> <span class="o">*******************************************</span>
 <span class="o">...</span><span class="p">:</span> <span class="p">[</span><span class="n">localhost</span><span class="p">]</span>

 <span class="n">TASK</span> <span class="p">[</span><span class="n">create</span> <span class="n">OSE</span> <span class="n">master</span> <span class="n">instances</span><span class="p">]</span> <span class="o">*********************************************</span>
 <span class="o">...</span><span class="p">:</span> <span class="p">[</span><span class="n">localhost</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">ose</span><span class="o">-</span><span class="n">master</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
 <span class="o">...</span><span class="p">:</span> <span class="p">[</span><span class="n">localhost</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">ose</span><span class="o">-</span><span class="n">master</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
 <span class="o">...</span><span class="p">:</span> <span class="p">[</span><span class="n">localhost</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">ose</span><span class="o">-</span><span class="n">master</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>

 <span class="n">TASK</span> <span class="p">[</span><span class="n">create</span> <span class="n">OSE</span> <span class="n">node</span> <span class="n">instances</span><span class="p">]</span> <span class="o">***********************************************</span>
 <span class="o">...</span><span class="p">:</span> <span class="p">[</span><span class="n">localhost</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">ose</span><span class="o">-</span><span class="n">node</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
 <span class="o">...</span><span class="p">:</span> <span class="p">[</span><span class="n">localhost</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">ose</span><span class="o">-</span><span class="n">node</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
 <span class="o">...</span><span class="p">:</span> <span class="p">[</span><span class="n">localhost</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">ose</span><span class="o">-</span><span class="n">node</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>
 <span class="o">...</span><span class="p">:</span> <span class="p">[</span><span class="n">localhost</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">ose</span><span class="o">-</span><span class="n">node</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span>

 <span class="n">TASK</span> <span class="p">[</span><span class="n">create</span> <span class="n">LB</span> <span class="n">instances</span><span class="p">]</span> <span class="o">*****************************************************</span>
 <span class="o">...</span><span class="p">:</span> <span class="p">[</span><span class="n">localhost</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">ose</span><span class="o">-</span><span class="n">lb</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
 <span class="o">...</span><span class="p">:</span> <span class="p">[</span><span class="n">localhost</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="n">ose</span><span class="o">-</span><span class="n">lb</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>

 <span class="n">TASK</span> <span class="p">[</span><span class="n">create</span> <span class="n">DNS</span> <span class="n">instance</span><span class="p">]</span> <span class="o">*****************************************************</span>
 <span class="o">...</span><span class="p">:</span> <span class="p">[</span><span class="n">localhost</span><span class="p">]</span>

 <span class="n">PLAY</span> <span class="n">RECAP</span> <span class="o">*********************************************************************</span>
 <span class="n">localhost</span>                  <span class="p">:</span> <span class="n">ok</span><span class="o">=...</span>   <span class="n">changed</span><span class="o">=...</span>    <span class="n">unreachable</span><span class="o">=</span><span class="mi">0</span>    <span class="n">failed</span><span class="o">=</span><span class="mi">0</span>

 <span class="mi">0</span>
</pre></div>
</div>
</div>
<div class="section" id="inventory">
<h2>Inventory<a class="headerlink" href="#inventory" title="Permalink to this headline">¶</a></h2>
<p>Now that we&#8217;ve provisioned our servers, let&#8217;s write an inventory file for them.</p>
<p>First, let&#8217;s create an OpenStack client instance.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">shade.inventory</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">inventory</span> <span class="o">=</span> <span class="n">shade</span><span class="o">.</span><span class="n">inventory</span><span class="o">.</span><span class="n">OpenStackInventory</span><span class="p">()</span>
</pre></div>
</div>
<p>Then build a list of our instance names to filter by.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">server_names</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="gp">... </span><span class="s2">demo-ose-installer</span>
<span class="gp">... </span><span class="s2">demo-ose-master-1</span>
<span class="gp">... </span><span class="s2">demo-ose-master-2</span>
<span class="gp">... </span><span class="s2">demo-ose-master-3</span>
<span class="gp">... </span><span class="s2">demo-ose-node-1</span>
<span class="gp">... </span><span class="s2">demo-ose-node-2</span>
<span class="gp">... </span><span class="s2">demo-ose-node-3</span>
<span class="gp">... </span><span class="s2">demo-ose-node-4</span>
<span class="gp">... </span><span class="s2">demo-ose-lb-1</span>
<span class="gp">... </span><span class="s2">demo-ose-lb-2</span>
<span class="gp">... </span><span class="s2">demo-ose-dns</span>
<span class="gp">... </span><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">server_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">server_names</span><span class="p">)</span>
</pre></div>
</div>
<p>Get a list of hosts, selecting only the ones above.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">hosts</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="p">[</span><span class="s1">u&#39;human_id&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">server_names</span><span class="p">,</span> <span class="n">inventory</span><span class="o">.</span><span class="n">list_hosts</span><span class="p">())</span>
</pre></div>
</div>
<p>Build a map of server name to IPs.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">address_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">e</span><span class="p">[</span><span class="s1">u&#39;human_id&#39;</span><span class="p">],</span> <span class="n">e</span><span class="p">[</span><span class="s1">u&#39;accessIPv4&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">hosts</span><span class="p">)</span>
</pre></div>
</div>
<p>Then write out the inventory file.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">inventory_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;hosts.cfg&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">inventory_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="gp">... </span><span class="s2">[hosts:children]</span>
<span class="gp">... </span><span class="s2">installer</span>
<span class="gp">... </span><span class="s2">masters</span>
<span class="gp">... </span><span class="s2">nodes</span>
<span class="gp">... </span><span class="s2">lbs</span>
<span class="gp">... </span><span class="s2">dns</span>
<span class="gp">... </span><span class="s2">[hosts:vars]</span>
<span class="gp">... </span><span class="s2">ansible_user=cloud-user</span>
<span class="gp">... </span><span class="s2">[OSEv3:children]</span>
<span class="gp">... </span><span class="s2">masters</span>
<span class="gp">... </span><span class="s2">nodes</span>
<span class="gp">... </span><span class="s2">[installer]</span>
<span class="gp">... </span><span class="s2">demo-ose-installer ansible_host={demo-ose-installer}</span>
<span class="gp">... </span><span class="s2">[masters]</span>
<span class="gp">... </span><span class="s2">demo-ose-master-1 ansible_host={demo-ose-master-1}</span>
<span class="gp">... </span><span class="s2">demo-ose-master-2 ansible_host={demo-ose-master-2}</span>
<span class="gp">... </span><span class="s2">demo-ose-master-3 ansible_host={demo-ose-master-3}</span>
<span class="gp">... </span><span class="s2">[nodes]</span>
<span class="gp">... </span><span class="s2">demo-ose-node-1 ansible_host={demo-ose-node-1}</span>
<span class="gp">... </span><span class="s2">demo-ose-node-2 ansible_host={demo-ose-node-2}</span>
<span class="gp">... </span><span class="s2">demo-ose-node-3 ansible_host={demo-ose-node-3}</span>
<span class="gp">... </span><span class="s2">demo-ose-node-4 ansible_host={demo-ose-node-4}</span>
<span class="gp">... </span><span class="s2">[lbs]</span>
<span class="gp">... </span><span class="s2">demo-ose-lb-1 ansible_host={demo-ose-lb-1}</span>
<span class="gp">... </span><span class="s2">demo-ose-lb-2 ansible_host={demo-ose-lb-2}</span>
<span class="gp">... </span><span class="s2">[dns]</span>
<span class="gp">... </span><span class="s2">demo-ose-dns ansible_host={demo-ose-dns}</span>
<span class="gp">... </span><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">address_map</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">inventory_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>Finally, let&#8217;s check that it works by calling Ansible to check our hosts.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ansible.cli.adhoc</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">shlex</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">run_ansible</span><span class="p">(</span><span class="n">cmd</span><span class="p">):</span>
<span class="gp">... </span>    <span class="sd">&quot;&quot;&quot;Helper function to run Ansible using the Ansible CLI.&quot;&quot;&quot;</span>
<span class="gp">... </span>    <span class="n">argv</span> <span class="o">=</span> <span class="n">shlex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">cli</span> <span class="o">=</span> <span class="n">ansible</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">adhoc</span><span class="o">.</span><span class="n">AdHocCLI</span><span class="p">([</span><span class="s1">&#39;ansible&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">argv</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">cli</span><span class="o">.</span><span class="n">parse</span><span class="p">()</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">cli</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>To check, let&#8217;s simply tell all of our hosts to report their hostname.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">run_ansible</span><span class="p">(</span><span class="s1">&#39;-i hosts.cfg -f 1 -o -m command -a &quot;hostname -s&quot; all&#39;</span><span class="p">)</span>
<span class="go">demo-ose-installer | SUCCESS | rc=0 | (stdout) demo-ose-installer</span>
<span class="go">demo-ose-master-1 | SUCCESS | rc=0 | (stdout) demo-ose-master-1</span>
<span class="go">demo-ose-master-2 | SUCCESS | rc=0 | (stdout) demo-ose-master-2</span>
<span class="go">demo-ose-master-3 | SUCCESS | rc=0 | (stdout) demo-ose-master-3</span>
<span class="go">demo-ose-node-1 | SUCCESS | rc=0 | (stdout) demo-ose-node-1</span>
<span class="go">demo-ose-node-2 | SUCCESS | rc=0 | (stdout) demo-ose-node-2</span>
<span class="go">demo-ose-node-3 | SUCCESS | rc=0 | (stdout) demo-ose-node-3</span>
<span class="go">demo-ose-node-4 | SUCCESS | rc=0 | (stdout) demo-ose-node-4</span>
<span class="go">demo-ose-lb-1 | SUCCESS | rc=0 | (stdout) demo-ose-lb-1</span>
<span class="go">demo-ose-lb-2 | SUCCESS | rc=0 | (stdout) demo-ose-lb-2</span>
<span class="go">demo-ose-dns | SUCCESS | rc=0 | (stdout) demo-ose-dns</span>
<span class="go">0</span>
</pre></div>
</div>
</div>
<div class="section" id="host-setup">
<h2>Host Setup<a class="headerlink" href="#host-setup" title="Permalink to this headline">¶</a></h2>
<p>OSE hosts must be configured to meet the prerequisites given in the OSE
installation documentation. This basically amounts to installing the required
packages and configuring Docker.</p>
<p>Here, we&#8217;ll also configure the additional instances needed to support our
environment, which includes the DNS server, load balancers, and the OSE
installer.</p>
<p>Below is the Ansible playbook used to perform these setup tasks.</p>
<div class="literal-block-wrapper container" id="ansible-setup-hosts-yaml">
<div class="code-block-caption"><span class="caption-text">ansible/setup-hosts.yaml</span><a class="headerlink" href="#ansible-setup-hosts-yaml" title="Permalink to this code">¶</a></div>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">gather facts about hosts</span>
  <span class="l l-Scalar l-Scalar-Plain">hosts</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">all</span>
  <span class="l l-Scalar l-Scalar-Plain">tasks</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[]</span>
  <span class="l l-Scalar l-Scalar-Plain">tags</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">facts</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">always</span>

<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">setup DNS server</span>
  <span class="l l-Scalar l-Scalar-Plain">hosts</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">dns</span>
  <span class="l l-Scalar l-Scalar-Plain">roles</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">dns-server</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">net-common</span>
  <span class="l l-Scalar l-Scalar-Plain">tags</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">dns</span>

<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">setup OSE nodes</span>
  <span class="l l-Scalar l-Scalar-Plain">hosts</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">nodes</span>
  <span class="l l-Scalar l-Scalar-Plain">roles</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ose-node</span>
  <span class="l l-Scalar l-Scalar-Plain">tags</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">node</span>

<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">setup OSE masters</span>
  <span class="l l-Scalar l-Scalar-Plain">hosts</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">masters</span>
  <span class="l l-Scalar l-Scalar-Plain">roles</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ose-master</span>
  <span class="l l-Scalar l-Scalar-Plain">tags</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">master</span>

<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">setup load balancers</span>
  <span class="l l-Scalar l-Scalar-Plain">hosts</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">lbs</span>
  <span class="l l-Scalar l-Scalar-Plain">roles</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">lb</span>
  <span class="l l-Scalar l-Scalar-Plain">tags</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">lb</span>

<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">setup OSE installer</span>
  <span class="l l-Scalar l-Scalar-Plain">hosts</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">installer</span>
  <span class="l l-Scalar l-Scalar-Plain">roles</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ose-installer</span>
  <span class="l l-Scalar l-Scalar-Plain">tags</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">installer</span>
</pre></div>
</div>
</div>
<p>All of the work in this playbook is done by the roles declared by each
play. Tags are also applied to allow for re-running plays for specific hosts
without needing to execute the entire playbook. All of the roles used are
defined in <cite>ansible/roles/</cite>.</p>
<p>Now let&#8217;s run it.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span> <span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">ansible.cli.playbook</span>
 <span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">shlex</span>
 <span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">run_playbook</span><span class="p">(</span><span class="n">cmd</span><span class="p">):</span>
 <span class="o">...</span>     <span class="s2">&quot;&quot;&quot;Helper function to run playbooks using the Playbook CLI.&quot;&quot;&quot;</span>
 <span class="o">...</span>     <span class="n">argv</span> <span class="o">=</span> <span class="n">shlex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
 <span class="o">...</span>     <span class="n">cli</span> <span class="o">=</span> <span class="n">ansible</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">playbook</span><span class="o">.</span><span class="n">PlaybookCLI</span><span class="p">([</span><span class="s1">&#39;ansible-playbook&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">argv</span><span class="p">)</span>
 <span class="o">...</span>     <span class="n">cli</span><span class="o">.</span><span class="n">parse</span><span class="p">()</span>
 <span class="o">...</span>     <span class="k">return</span> <span class="n">cli</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
 <span class="o">&gt;&gt;&gt;</span> <span class="n">run_playbook</span><span class="p">(</span><span class="s1">&#39;-i hosts.cfg -b -T 20 ansible/setup-hosts.yaml&#39;</span><span class="p">)</span>

 <span class="n">PLAY</span> <span class="p">[</span><span class="n">gather</span> <span class="n">facts</span> <span class="n">about</span> <span class="n">hosts</span><span class="p">]</span> <span class="o">************************************************</span>
 <span class="o">...</span>
 <span class="n">PLAY</span> <span class="p">[</span><span class="n">setup</span> <span class="n">DNS</span> <span class="n">server</span><span class="p">]</span> <span class="o">********************************************************</span>
 <span class="o">...</span>
 <span class="n">PLAY</span> <span class="p">[</span><span class="n">setup</span> <span class="n">OSE</span> <span class="n">nodes</span><span class="p">]</span> <span class="o">*********************************************************</span>
 <span class="o">...</span>
 <span class="n">PLAY</span> <span class="p">[</span><span class="n">setup</span> <span class="n">OSE</span> <span class="n">masters</span><span class="p">]</span> <span class="o">*******************************************************</span>
 <span class="o">...</span>
 <span class="n">PLAY</span> <span class="p">[</span><span class="n">setup</span> <span class="n">load</span> <span class="n">balancers</span><span class="p">]</span> <span class="o">****************************************************</span>
 <span class="o">...</span>
 <span class="n">PLAY</span> <span class="p">[</span><span class="n">setup</span> <span class="n">OSE</span> <span class="n">installer</span><span class="p">]</span> <span class="o">*****************************************************</span>
 <span class="o">...</span>
 <span class="n">PLAY</span> <span class="n">RECAP</span> <span class="o">*********************************************************************</span>
 <span class="n">demo</span><span class="o">-</span><span class="n">ose</span><span class="o">-</span><span class="n">dns</span>               <span class="p">:</span> <span class="n">ok</span><span class="o">=...</span>   <span class="n">changed</span><span class="o">=...</span>    <span class="n">unreachable</span><span class="o">=</span><span class="mi">0</span>    <span class="n">failed</span><span class="o">=</span><span class="mi">0</span>
 <span class="n">demo</span><span class="o">-</span><span class="n">ose</span><span class="o">-</span><span class="n">installer</span>         <span class="p">:</span> <span class="n">ok</span><span class="o">=...</span>   <span class="n">changed</span><span class="o">=...</span>    <span class="n">unreachable</span><span class="o">=</span><span class="mi">0</span>    <span class="n">failed</span><span class="o">=</span><span class="mi">0</span>
 <span class="n">demo</span><span class="o">-</span><span class="n">ose</span><span class="o">-</span><span class="n">lb</span><span class="o">-</span><span class="mi">1</span>              <span class="p">:</span> <span class="n">ok</span><span class="o">=...</span>   <span class="n">changed</span><span class="o">=...</span>    <span class="n">unreachable</span><span class="o">=</span><span class="mi">0</span>    <span class="n">failed</span><span class="o">=</span><span class="mi">0</span>
 <span class="n">demo</span><span class="o">-</span><span class="n">ose</span><span class="o">-</span><span class="n">lb</span><span class="o">-</span><span class="mi">2</span>              <span class="p">:</span> <span class="n">ok</span><span class="o">=...</span>   <span class="n">changed</span><span class="o">=...</span>    <span class="n">unreachable</span><span class="o">=</span><span class="mi">0</span>    <span class="n">failed</span><span class="o">=</span><span class="mi">0</span>
 <span class="n">demo</span><span class="o">-</span><span class="n">ose</span><span class="o">-</span><span class="n">master</span><span class="o">-</span><span class="mi">1</span>          <span class="p">:</span> <span class="n">ok</span><span class="o">=...</span>   <span class="n">changed</span><span class="o">=...</span>    <span class="n">unreachable</span><span class="o">=</span><span class="mi">0</span>    <span class="n">failed</span><span class="o">=</span><span class="mi">0</span>
 <span class="n">demo</span><span class="o">-</span><span class="n">ose</span><span class="o">-</span><span class="n">master</span><span class="o">-</span><span class="mi">2</span>          <span class="p">:</span> <span class="n">ok</span><span class="o">=...</span>   <span class="n">changed</span><span class="o">=...</span>    <span class="n">unreachable</span><span class="o">=</span><span class="mi">0</span>    <span class="n">failed</span><span class="o">=</span><span class="mi">0</span>
 <span class="n">demo</span><span class="o">-</span><span class="n">ose</span><span class="o">-</span><span class="n">master</span><span class="o">-</span><span class="mi">3</span>          <span class="p">:</span> <span class="n">ok</span><span class="o">=...</span>   <span class="n">changed</span><span class="o">=...</span>    <span class="n">unreachable</span><span class="o">=</span><span class="mi">0</span>    <span class="n">failed</span><span class="o">=</span><span class="mi">0</span>
 <span class="n">demo</span><span class="o">-</span><span class="n">ose</span><span class="o">-</span><span class="n">node</span><span class="o">-</span><span class="mi">1</span>            <span class="p">:</span> <span class="n">ok</span><span class="o">=...</span>   <span class="n">changed</span><span class="o">=...</span>    <span class="n">unreachable</span><span class="o">=</span><span class="mi">0</span>    <span class="n">failed</span><span class="o">=</span><span class="mi">0</span>
 <span class="n">demo</span><span class="o">-</span><span class="n">ose</span><span class="o">-</span><span class="n">node</span><span class="o">-</span><span class="mi">2</span>            <span class="p">:</span> <span class="n">ok</span><span class="o">=...</span>   <span class="n">changed</span><span class="o">=...</span>    <span class="n">unreachable</span><span class="o">=</span><span class="mi">0</span>    <span class="n">failed</span><span class="o">=</span><span class="mi">0</span>
 <span class="n">demo</span><span class="o">-</span><span class="n">ose</span><span class="o">-</span><span class="n">node</span><span class="o">-</span><span class="mi">3</span>            <span class="p">:</span> <span class="n">ok</span><span class="o">=...</span>   <span class="n">changed</span><span class="o">=...</span>    <span class="n">unreachable</span><span class="o">=</span><span class="mi">0</span>    <span class="n">failed</span><span class="o">=</span><span class="mi">0</span>
 <span class="n">demo</span><span class="o">-</span><span class="n">ose</span><span class="o">-</span><span class="n">node</span><span class="o">-</span><span class="mi">4</span>            <span class="p">:</span> <span class="n">ok</span><span class="o">=...</span>   <span class="n">changed</span><span class="o">=...</span>    <span class="n">unreachable</span><span class="o">=</span><span class="mi">0</span>    <span class="n">failed</span><span class="o">=</span><span class="mi">0</span>

 <span class="mi">0</span>
</pre></div>
</div>
</div>
<div class="section" id="ose-installation">
<h2>OSE Installation<a class="headerlink" href="#ose-installation" title="Permalink to this headline">¶</a></h2>
<p>Once all hosts are configured, we&#8217;re able install OSE using the advanced
installation method. The installer is actually run remotely on the OSE
installer host, using the following Ansible playbook.</p>
<div class="literal-block-wrapper container" id="ansible-deploy-ose-yaml">
<div class="code-block-caption"><span class="caption-text">ansible/deploy-ose.yaml</span><a class="headerlink" href="#ansible-deploy-ose-yaml" title="Permalink to this code">¶</a></div>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">deploy OSE</span>
  <span class="l l-Scalar l-Scalar-Plain">hosts</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">installer</span>
  <span class="l l-Scalar l-Scalar-Plain">tags</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">install</span>
  <span class="l l-Scalar l-Scalar-Plain">tasks</span><span class="p p-Indicator">:</span>

    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">run deployment playbook</span>
      <span class="l l-Scalar l-Scalar-Plain">command</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ansible-playbook /usr/share/ansible/openshift-ansible/playbooks/byo/config.yml</span>
      <span class="l l-Scalar l-Scalar-Plain">become</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>

<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">configure OSE components</span>
  <span class="l l-Scalar l-Scalar-Plain">hosts</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">demo-ose-master-1</span>
  <span class="l l-Scalar l-Scalar-Plain">tasks</span><span class="p p-Indicator">:</span>

    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">deploy internal registry</span>
      <span class="l l-Scalar l-Scalar-Plain">tags</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">registry</span>
      <span class="l l-Scalar l-Scalar-Plain">command</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">&gt;</span>
        <span class="no">oadm registry --config=/etc/origin/master/admin.kubeconfig</span>
        <span class="no">--service-account=registry</span>
        <span class="no">--images=&#39;registry.access.redhat.com/openshift3/ose-${component}:${version}&#39;</span>
      <span class="l l-Scalar l-Scalar-Plain">become</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>

    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">create router certs</span>
      <span class="l l-Scalar l-Scalar-Plain">tags</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">router</span>
      <span class="l l-Scalar l-Scalar-Plain">command</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">&gt;</span>
        <span class="no">oadm ca create-server-cert</span>
        <span class="no">--signer-cert=/etc/origin/master/ca.crt</span>
        <span class="no">--signer-key=/etc/origin/master/ca.key</span>
        <span class="no">--signer-serial=/etc/origin/master/ca.serial.txt</span>
        <span class="no">--hostnames=&#39;*.apps.osedemo.example.com&#39;</span>
        <span class="no">--cert=/etc/origin/master/apps.crt</span>
        <span class="no">--key=/etc/origin/master/apps.key</span>
      <span class="l l-Scalar l-Scalar-Plain">args</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">creates</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/origin/master/apps.key</span>
      <span class="l l-Scalar l-Scalar-Plain">become</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>

    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">create router PEM file</span>
      <span class="l l-Scalar l-Scalar-Plain">tags</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">router</span>
      <span class="l l-Scalar l-Scalar-Plain">shell</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">&gt;</span>
        <span class="no">cat /etc/origin/master/apps.crt /etc/origin/master/apps.key</span>
        <span class="no">/etc/origin/master/ca.crt &gt; /etc/origin/master/apps.pem</span>
      <span class="l l-Scalar l-Scalar-Plain">args</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">creates</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/origin/master/apps.pem</span>
      <span class="l l-Scalar l-Scalar-Plain">become</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>

    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">create router</span>
      <span class="l l-Scalar l-Scalar-Plain">tags</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">router</span>
      <span class="l l-Scalar l-Scalar-Plain">command</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">&gt;</span>
        <span class="no">oadm router router --replicas=2</span>
        <span class="no">--credentials=&#39;/etc/origin/master/openshift-router.kubeconfig&#39;</span>
        <span class="no">--service-account=router</span>
      <span class="l l-Scalar l-Scalar-Plain">become</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</pre></div>
</div>
</div>
<p>To perform the installation, run:</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>$ ansible-playbook -i hosts.cfg ansible/deploy-ose.yaml
</pre></div>
</div>
<p>Once complete, the OSE environment will be installed and running.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Deployment on OpenStack</a><ul>
<li><a class="reference internal" href="#architecture">Architecture</a></li>
<li><a class="reference internal" href="#openstack-environment">OpenStack Environment</a></li>
<li><a class="reference internal" href="#prerequisites">Prerequisites</a><ul>
<li><a class="reference internal" href="#images">Images</a></li>
<li><a class="reference internal" href="#flavors">Flavors</a></li>
<li><a class="reference internal" href="#security-groups">Security Groups</a></li>
</ul>
</li>
<li><a class="reference internal" href="#provisioning">Provisioning</a></li>
<li><a class="reference internal" href="#inventory">Inventory</a></li>
<li><a class="reference internal" href="#host-setup">Host Setup</a></li>
<li><a class="reference internal" href="#ose-installation">OSE Installation</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="README.html" title="previous chapter">README</a></li>
      <li>Next: <a href="security-groups.html" title="next chapter">Security Groups</a></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/openstack.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, Alex Smith.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.4.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.8</a>
      
      |
      <a href="_sources/openstack.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>